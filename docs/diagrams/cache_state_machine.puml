@startuml cache_state_machine
!theme plain
skinparam backgroundColor white

title Machine à États du Cache

[*] --> Empty : Premier démarrage

state Empty {
    Empty : Cache mémoire: ∅
    Empty : Cache disque: ∅
}

state MemoryOnly {
    MemoryOnly : Cache mémoire: ✅ (< 5 min)
    MemoryOnly : Cache disque: ✅
}

state DiskOnly {
    DiskOnly : Cache mémoire: ❌ (expiré)
    DiskOnly : Cache disque: ✅ (toujours valide)
}

state BothValid {
    BothValid : Cache mémoire: ✅
    BothValid : Cache disque: ✅
}

Empty --> BothValid : API Call\nSauvegarde mémoire + disque
BothValid --> DiskOnly : Attendre > 5 min\nExpiration mémoire
DiskOnly --> BothValid : Lecture disque\nRecharge mémoire
BothValid --> BothValid : get_devices()\nCache mémoire valide\n⚡ 1-2 ms
DiskOnly --> DiskOnly : get_devices()\nLecture disque\n💾 10-50 ms
Empty --> Empty : get_devices()\nAppel API\n🌐 200-1000 ms

note right of BothValid
  **État optimal**
  Performance maximale
  Pas d'I/O disque
  Pas de requête réseau
end note

note right of DiskOnly
  **État de secours**
  Après 5 min d'inactivité
  Lecture disque rapide
  Pas de requête réseau
end note

note right of Empty
  **État initial**
  Premier lancement
  Nécessite API call
  Initialise les caches
end note

@enduml
