@startuml cache_state_machine
!theme plain
skinparam backgroundColor white

title Machine Ã  Ã‰tats du Cache

[*] --> Empty : Premier dÃ©marrage

state Empty {
    Empty : Cache mÃ©moire: âˆ…
    Empty : Cache disque: âˆ…
}

state MemoryOnly {
    MemoryOnly : Cache mÃ©moire: âœ… (< 5 min)
    MemoryOnly : Cache disque: âœ…
}

state DiskOnly {
    DiskOnly : Cache mÃ©moire: âŒ (expirÃ©)
    DiskOnly : Cache disque: âœ… (toujours valide)
}

state BothValid {
    BothValid : Cache mÃ©moire: âœ…
    BothValid : Cache disque: âœ…
}

Empty --> BothValid : API Call\nSauvegarde mÃ©moire + disque
BothValid --> DiskOnly : Attendre > 5 min\nExpiration mÃ©moire
DiskOnly --> BothValid : Lecture disque\nRecharge mÃ©moire
BothValid --> BothValid : get_devices()\nCache mÃ©moire valide\nâš¡ 1-2 ms
DiskOnly --> DiskOnly : get_devices()\nLecture disque\nğŸ’¾ 10-50 ms
Empty --> Empty : get_devices()\nAppel API\nğŸŒ 200-1000 ms

note right of BothValid
  **Ã‰tat optimal**
  Performance maximale
  Pas d'I/O disque
  Pas de requÃªte rÃ©seau
end note

note right of DiskOnly
  **Ã‰tat de secours**
  AprÃ¨s 5 min d'inactivitÃ©
  Lecture disque rapide
  Pas de requÃªte rÃ©seau
end note

note right of Empty
  **Ã‰tat initial**
  Premier lancement
  NÃ©cessite API call
  Initialise les caches
end note

@enduml
