@startuml cache_flow_diagram
!theme plain
skinparam backgroundColor white
skinparam defaultFontSize 12
skinparam rectangleFontSize 14
skinparam noteFontSize 11

title SystÃ¨me de Cache Multi-Niveaux - Device List

actor "Utilisateur" as user
participant "CLI\nalexa device list" as cli #LightBlue
participant "DeviceManager\nget_devices()" as dm #LightGreen
participant "Cache MÃ©moire\n(RAM)\nTTL: 5 min" as mem #Yellow
participant "CacheService\nget(ignore_ttl=True)" as cs #Orange
participant "Cache Disque\n(devices.json.gz)\nTTL: âˆž AUCUN" as disk #LightCoral
participant "Amazon API\nalexa.amazon.com" as api #Red

== ScÃ©nario 1: Cache MÃ©moire Valide ==
user -> cli: alexa device list
cli -> dm: get_devices()
dm -> mem: VÃ©rifier TTL
mem -> mem: âœ… TTL < 5 min
note right: **âš¡ 1-2 ms**
mem --> dm: Liste de 8 appareils
dm --> cli: Retour
cli --> user: Affichage

== ScÃ©nario 2: Cache MÃ©moire ExpirÃ© â†’ Disque ==
user -> cli: alexa device list
cli -> dm: get_devices()
dm -> mem: VÃ©rifier TTL
mem -> mem: âŒ TTL > 5 min
dm -> cs: get("devices", ignore_ttl=True)
cs -> disk: Lire fichier
disk -> disk: âœ… Fichier existe\n(toujours valide)
note right: **ðŸ’¾ 10-50 ms**\nPas de vÃ©rification TTL
disk --> cs: DonnÃ©es dÃ©compressÃ©es
cs --> dm: Liste de 8 appareils
dm -> mem: Mise Ã  jour cache RAM
dm --> cli: Retour
cli --> user: Affichage

== ScÃ©nario 3: Pas de Cache â†’ API ==
user -> cli: alexa device list
cli -> dm: get_devices()
dm -> mem: VÃ©rifier TTL
mem -> mem: âŒ Vide (premier dÃ©marrage)
dm -> cs: get("devices", ignore_ttl=True)
cs -> disk: Lire fichier
disk -> disk: âŒ Fichier absent
cs --> dm: None
dm -> api: GET /api/devices-v2/device
note right: **ðŸŒ 200-1000 ms**\nRÃ©quÃªte HTTP
api --> dm: RÃ©ponse JSON
dm -> disk: Sauvegarder (gzip)
dm -> mem: Sauvegarder (RAM)
dm --> cli: Retour
cli --> user: Affichage

@enduml
