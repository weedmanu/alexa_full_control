<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Install diagrams - Alexa Advanced Control</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px;background:#f7f7fb;color:#111}
    .card{background:white;padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(17,24,39,0.06);margin-bottom:12px}
    pre{background:#0b1221;color:#e6f1ff;padding:12px;border-radius:6px;overflow:auto}
    .imgwrap{margin-top:12px}
    .button{background:#2563eb;color:white;padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
    h1{color:#0b5fff}
    h2{color:#0b3bbf}
  </style>
</head>
<body>
  <h1>Diagrammes de l'installation</h1>
  <p>Visualise le diagramme d'aperçu et clique sur une case pour afficher le sous-diagramme détaillé.</p>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start">
    <div class="card">
      <h2>Aperçu</h2>
      <div id="overview" class="imgwrap">
  <!-- inlined install_overview.svg (generated) -->
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="736px" preserveAspectRatio="none" style="width:100%;height:736px;background:#FFFFFF;" version="1.1" viewBox="0 0 941 736" width="941px" zoomAndPan="magnify"><defs/><g><ellipse cx="375.0659" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1;"/><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="121.6719" x="314.23" y="50"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="101.6719" x="324.23" y="72.9492">Lancer l'installateur</text><polygon fill="#F1F1F1" points="337.5676,105.9609,412.5642,105.9609,424.5642,117.9609,412.5642,129.9609,337.5676,129.9609,325.5676,117.9609,337.5676,105.9609" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="74.9966" x="337.5676" y="122.5156">D&#195;&#169;sinstaller ?</text><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="15.3345" x="310.2332" y="115.2002">oui</text><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="18.8955" x="424.5642" y="115.2002">non</text><rect fill="#FDEBD0" height="35.9609" rx="12.5" ry="12.5" style="stroke:#E6B0AA;stroke-width:0.5;" width="287.2461" x="11" y="139.9609"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="129.0352" x="21" y="162.9102">D&#195;&#169;sinstallation &#171;sous&#187;</text><a href="install_uninstall_detail.svg" target="_top" title="install_uninstall_detail.svg" xlink:actuate="onRequest" xlink:href="install_uninstall_detail.svg" xlink:show="new" xlink:title="install_uninstall_detail.svg" xlink:type="simple"><text fill="#0000FF" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" text-decoration="underline" textLength="134.9238" x="153.3223" y="162.9102">install_uninstall_detail.svg</text></a><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="135.1953" x="551.9111" y="139.9609"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="115.1953" x="561.9111" y="162.9102">V&#195;&#169;rifier le syst&#195;&#168;me</text><line style="stroke:#181818;stroke-width:1.5;" x1="438.3984" x2="763.6611" y1="195.9219" y2="195.9219"/><rect fill="#FDEBD0" height="35.9609" rx="12.5" ry="12.5" style="stroke:#E6B0AA;stroke-width:0.5;" width="260.3047" x="308.2461" y="215.9219"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="121.8867" x="318.2461" y="238.8711">Protection venv &#171;sous&#187;</text><a href="install_venv_detail.svg" target="_top" title="install_venv_detail.svg" xlink:actuate="onRequest" xlink:href="install_venv_detail.svg" xlink:show="new" xlink:title="install_venv_detail.svg" xlink:type="simple"><text fill="#0000FF" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" text-decoration="underline" textLength="115.1309" x="443.4199" y="238.8711">install_venv_detail.svg</text></a><rect fill="#FDEBD0" height="35.9609" rx="12.5" ry="12.5" style="stroke:#E6B0AA;stroke-width:0.5;" width="334.2207" x="596.5508" y="215.9219"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="185.2031" x="606.5508" y="238.8711">V&#195;&#169;rifier / installer Node.js &#171;sous&#187;</text><a href="install_nodejs_detail.svg" target="_top" title="install_nodejs_detail.svg" xlink:actuate="onRequest" xlink:href="install_nodejs_detail.svg" xlink:show="new" xlink:title="install_nodejs_detail.svg" xlink:type="simple"><text fill="#0000FF" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" text-decoration="underline" textLength="125.7305" x="795.041" y="238.8711">install_nodejs_detail.svg</text></a><line style="stroke:#181818;stroke-width:1.5;" x1="438.3984" x2="763.6611" y1="271.8828" y2="271.8828"/><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="353.5098" x="442.7539" y="291.8828"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="207.2168" x="452.7539" y="314.832">Installer les paquets (pip / npm) &#171;sous&#187;</text><a href="install_create_detail.svg" target="_top" title="install_create_detail.svg" xlink:actuate="onRequest" xlink:href="install_create_detail.svg" xlink:show="new" xlink:title="install_create_detail.svg" xlink:type="simple"><text fill="#0000FF" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" text-decoration="underline" textLength="123.0059" x="663.2578" y="314.832">install_create_detail.svg</text></a><polygon fill="#F1F1F1" points="568.6553,347.8438,670.3623,347.8438,682.3623,359.8438,670.3623,371.8438,568.6553,371.8438,556.6553,359.8438,568.6553,347.8438" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="101.707" x="568.6553" y="364.3984">Ex&#195;&#169;cuter les tests ?</text><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="15.3345" x="541.3208" y="357.083">oui</text><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="18.8955" x="682.3623" y="357.083">non</text><rect fill="#FDEBD0" height="35.9609" rx="12.5" ry="12.5" style="stroke:#E6B0AA;stroke-width:0.5;" width="280.168" x="374.6587" y="381.8438"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="141.7207" x="384.6587" y="404.793">Ex&#195;&#169;cuter les tests &#171;sous&#187;</text><a href="install_tests_detail.svg" target="_top" title="install_tests_detail.svg" xlink:actuate="onRequest" xlink:href="install_tests_detail.svg" xlink:show="new" xlink:title="install_tests_detail.svg" xlink:type="simple"><text fill="#0000FF" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" text-decoration="underline" textLength="115.1602" x="529.6665" y="404.793">install_tests_detail.svg</text></a><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="98.8965" x="674.8267" y="381.8438"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="78.8965" x="684.8267" y="404.793">Passer les tests</text><polygon fill="#F1F1F1" points="619.5088,423.8047,631.5088,435.8047,619.5088,447.8047,607.5088,435.8047,619.5088,423.8047" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="35.9609" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="129.6406" x="554.6885" y="467.8047"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="109.6406" x="564.6885" y="490.7539">Finaliser l'installation</text><rect fill="#FDEBD0" height="35.9609" rx="12.5" ry="12.5" style="stroke:#E6B0AA;stroke-width:0.5;" width="293.627" x="472.6953" y="573.0811"/><text fill="#000000" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" textLength="148.8574" x="482.6953" y="596.0303">Rollback / nettoyage &#171;sous&#187;</text><a href="install_errors_detail.svg" target="_top" title="install_errors_detail.svg" xlink:actuate="onRequest" xlink:href="install_errors_detail.svg" xlink:show="new" xlink:title="install_errors_detail.svg" xlink:type="simple"><text fill="#0000FF" font-family="'Segoe UI'" font-size="12" lengthAdjust="spacing" text-decoration="underline" textLength="121.4824" x="634.8398" y="596.0303">install_errors_detail.svg</text></a><polygon fill="#F1F1F1" points="562.7095,523.7656,676.3081,523.7656,688.3081,535.7656,676.3081,547.7656,562.7095,547.7656,550.7095,535.7656,562.7095,523.7656" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="15.3345" x="623.5088" y="559.6357">oui</text><text fill="#000000" font-family="'Segoe UI'" font-size="11" lengthAdjust="spacing" textLength="113.5986" x="562.7095" y="540.3203">Erreurs d&#195;&#169;tect&#195;&#169;es ?</text><polygon fill="#F1F1F1" points="619.5088,629.042,631.5088,641.042,619.5088,653.042,607.5088,641.042,619.5088,629.042" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="375.0659,659.042,387.0659,671.042,375.0659,683.042,363.0659,671.042,375.0659,659.042" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="375.0659" cy="714.042" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1;"/><ellipse cx="375.0659":[TRUNCATED] /></g></svg>
      </div>
      <div class="help">Les cases pastel sont cliquables pour ouvrir le sous‑diagramme détaillé.</div>
    </div>

    <div class="card">
      <h2>Détails</h2>
      <div id="controls" style="margin-bottom:8px"></div>
      <div id="detail" class="imgwrap"></div>
    </div>
  </div>

  <script>
  // Viewer LOCAL-ONLY: affiche uniquement les SVG locaux (ou le .puml si SVG absent).
  // Overview and detailed diagrams
  const OVERVIEW = 'install_overview';
  const DETAILS = [
    { id: 'install_uninstall_detail', label: 'Uninstall' },
    { id: 'install_venv_detail', label: 'Venv' },
    { id: 'install_nodejs_detail', label: 'NodeJS' },
    { id: 'install_create_detail', label: 'Install packages' },
    { id: 'install_tests_detail', label: 'Tests' },
    { id: 'install_errors_detail', label: 'Errors / Rollback' }
  ];

  // Utility to show an svg or fall back to puml text
  function showDiagram(container, name){
    container.innerHTML = '';
    const svgPath = name + '.svg';
    const pumlPath = name + '.puml';

    const img = document.createElement('img');
    img.src = svgPath; img.alt = svgPath; img.style.maxWidth = '100%';
    img.onload = () => { container.appendChild(img); };
    img.onerror = () => {
      fetch(pumlPath).then(r => {
        if (!r.ok) throw new Error('PUML missing');
        return r.text();
      }).then(text => {
        const pre = document.createElement('pre'); pre.textContent = text.trim(); container.appendChild(pre);
      }).catch(() => {
        const err = document.createElement('div'); err.textContent = 'Aucun SVG local ni PUML pour ' + name; container.appendChild(err);
      });
    };
  }

  window.addEventListener('load', () => {
    // Load overview on left
    const overviewEl = document.getElementById('overview');
    // overview is inlined: attach click handlers to several text nodes
    const mapping = {
      'Désinstallation': 'install_uninstall_detail',
      'Protection venv': 'install_venv_detail',
      "NodeJS check/install": 'install_nodejs_detail',
      'Installer les paquets (pip / npm)': 'install_create_detail',
      'Exécuter les tests': 'install_tests_detail',
      'Rollback / nettoyage': 'install_errors_detail'
    };
    // Wait a tick to ensure SVG content is present
    setTimeout(() => {
      const svg = overviewEl.querySelector('svg');
      if (svg) {
        // bind clicks on <a> links generated inside the SVG (PlantUML may emit <a>)
        const links = svg.querySelectorAll('a');
        links.forEach(a => {
          a.addEventListener('click', (ev) => {
            ev.preventDefault(); ev.stopPropagation();
            const href = a.getAttribute('xlink:href') || a.getAttribute('href') || a.getAttribute('xlink:href');
            if (!href) return;
            const basename = href.split('/').pop().replace('.svg','');
            const detailEl = document.getElementById('detail');
            showDiagram(detailEl, basename);
          });
          // make cursor pointer for whole link area
          try { a.style.cursor = 'pointer'; } catch(e){}
        });

        // also bind clicks on text nodes matching our mapping (fallback)
        const texts = svg.querySelectorAll('text');
        texts.forEach(t => {
          const txt = t.textContent && t.textContent.trim();
          if (!txt) return;
          Object.keys(mapping).forEach(k => {
            if (txt.indexOf(k) !== -1) {
              t.style.cursor = 'pointer';
              t.addEventListener('click', () => {
                const detailEl = document.getElementById('detail');
                showDiagram(detailEl, mapping[k]);
              });
            }
          });
        });
      }
    }, 50);

    // Build controls
    const ctrl = document.getElementById('controls');
    const detailEl = document.getElementById('detail');
    <!doctype html>
    <html lang="fr">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>Install diagrams - Alexa Advanced Control</title>
      <style>
        body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px;background:#f7f7fb;color:#111}
        .card{background:white;padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(17,24,39,0.06);margin-bottom:12px}
        pre{background:#0b1221;color:#e6f1ff;padding:12px;border-radius:6px;overflow:auto}
        .imgwrap{margin-top:12px}
        .button{background:#2563eb;color:white;padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
        h1{color:#0b5fff}
        h2{color:#0b3bbf}
      </style>
    </head>
    <body>
      <h1>Diagrammes de l'installation</h1>
      <p>Visualise les diagrammes PlantUML décrivant les flux principaux du script <code>scripts/install.py</code>.</p>
      <div id="list"></div>

      <script>
      // Simple viewer: affiche install_full_flow.svg ou le .puml si SVG absent
      const FILES = ['install_full_flow'];
      function makeCard(name){
        const list = document.getElementById('list');
        const card = document.createElement('div'); card.className='card';
        const title = document.createElement('h2'); title.textContent = name.replace(/_/g,' '); card.appendChild(title);
        const svgPath = name + '.svg';
        const pumlPath = name + '.puml';
        const img = document.createElement('img');
        img.src = svgPath; img.alt = svgPath; img.style.maxWidth='100%';
        img.onload = function(){ card.appendChild(img); };
        img.onerror = function(){
          fetch(pumlPath).then(function(r){ if (!r.ok) throw new Error('PUML missing'); return r.text(); }).then(function(text){ var pre = document.createElement('pre'); pre.textContent = text.trim(); card.appendChild(pre); }).catch(function(){ var e = document.createElement('div'); e.textContent = 'Aucun SVG local ni PUML pour '+name; card.appendChild(e); });
        };
        list.appendChild(card);
      }
      window.addEventListener('load', function(){ FILES.forEach(makeCard); });
      </script>
    </body>
    </html>
